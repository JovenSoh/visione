<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">

<title>VBS</title>
<link rel="stylesheet" href="css/jquery-ui.min.css" >
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" >
<link rel="stylesheet" href="css/bootstrap.css" >
<link rel="stylesheet" href="css/vbs.css" >
<script src="js/jquery-3.3.1.min.js"></script>
<script src="js/jquery-ui.min.js"></script>
<script src="js/fabric.js"></script>
<script src="js/vbs.js"></script>
<script src="js/canvas.js"></script>

</head>
<body oncontextmenu="return false;">
	<div align="center" style="padding-top: 8px; padding-bottom: 15px;">
		<img src="img/visione-side.png" height="96px"
			style="border-radius: 20px 20px 20px 20px;" alt="">
	</div>
	<div id="dialog" title="Tag Name">
		<label>tag</label> <input id="tag" name="tag" type="text">
	</div>
	<div id="content" class="container-fluid" style="padding-top: 10px;">
	
		<div class="row">
		<table>
									
			<tr valign="top">
				<td id='canvasTab'><div id="canvasdiv1"><canvas id='canvas1' width=380 height=213
						style="border: 1px solid #000000;"></canvas></div>
						
						
						<div class="row">
			<div class="col-7 top5">
				<div>
					<button id="clean" class="btn btn-outline-info"	title="clean">
						<i class="fa fa-trash"></i> clean	</button>
					<button id="undo" class="btn btn-outline-info" title="undo clean">
						<i class="fa fa-reply"></i> un-clean
					</button>
				</div>
			</div>
		</div>
		
				
				</td>
				<td align="left">
					<table>
						<tr valign="top">
							<td colspan="13">Scene description <input id='captions0'
								type="text" size="64" placeholder="E.g.: A tennis player serving a ball on the court"></td>
						</tr>
						<tr valign="top">
							<td colspan="13">Scene tags <input id='annotations0'
								type="text" size="71" placeholder="E.g.: wedding park sunset"></td>
						</tr>
						<tr valign="top">
							<td colspan="13">Max obj. number <input id='not0'
								type="text" size="65" placeholder="E.g.: 2 person 3 car 0 dog, means at most 2 persons, 3 cars, no dogs"></td>
						</tr>
						<tr valign="top">
							<td colspan="13"><input id='annotations1'
								type="hidden" size="71" placeholder="E.g.: wedding park sunset"></td>
						</tr>
						<tr valign="top">
							<td colspan="13"><input id='not1'
								type="hidden" size="65" placeholder="E.g.: 2 person 3 car 0 dog, means at most 2 persons, 3 cars, no dogs"></td>
						</tr>

						
						<tr valign="top">
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="person" title="person"src="img/icons/person.png"/></td>
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="humanface" title="humanface"src="img/icons/humanface.png"/></td>
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="musician" title="musician"src="img/icons/musician.png"/></td>
						
						
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="athlete" title="athlete"src="img/icons/athlete.png"/></td>
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="skateboard" title="skateboard"src="img/icons/skateboard.png"/></td>
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="clothing" title="clothing"src="img/icons/clothing.png"/></td>
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="tie" title="tie"src="img/icons/tie.png"/></td>
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="footwear" title="footwear"src="img/icons/footwear.png"/></td>
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="glasses" title="glasses"src="img/icons/glasses.png"/></td>
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="bicycle" title="bicycle"src="img/icons/bicycle.png"/></td>
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="vehicle" title="vehicle"src="img/icons/vehicle.png"/></td>
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="motorbike" title="motorbike"src="img/icons/motorcycle.png"/></td>
						
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="car" title="car"src="img/icons/car.png"/></td>
						
						
												
						</tr><tr valign="top">
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="truck" title="truck"src="img/icons/truck.png"/></td>
						
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="boat" title="boat"src="img/icons/boat.png"/></td>
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="parachute" title="parachute"src="img/icons/parachute.png"/></td>
						
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="aeroplane" title="aeroplane"src="img/icons/aeroplane.png"/></td>
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="bench" title="bench"src="img/icons/bench.png"/></td>
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="chair" title="chair"src="img/icons/chair.png"/></td>
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="sofa" title="sofa"src="img/icons/sofa.png"/></td>
						
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="building" title="building"src="img/icons/building.png"/></td>
												
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="clock" title="clock"src="img/icons/clock.png"/></td>

						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="bowl" title="bowl"src="img/icons/bowl.png"/></td>
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="bottle" title="bottle"src="img/icons/bottle.png"/></td>
						
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="wineglass" title="wineglass"src="img/icons/wineglass.png"/></td>
						
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="cup" title="cup"src="img/icons/cup.png"/></td>

						

						
						
						</tr><tr valign="top">
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="dessert" title="dessert"src="img/icons/dessert.png"/></td>
						
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="cellphone" title="cellphone"src="img/icons/cellphone.png"/></td>
						
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="display" title="display"src="img/icons/display.png"/></td>
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="keyboard" title="keyboard"src="img/icons/keyboard.png"/></td>
						
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="laptop" title="laptop"src="img/icons/laptop.png"/></td>
						
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="book" title="book"src="img/icons/book.png"/></td>
						
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="cat" title="cat"src="img/icons/cat.png"/></td>
						
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="dog" title="dog"src="img/icons/dog.png"/></td>
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="horse" title="horse"src="img/icons/horse.png"/></td>
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="teddy" title="teddy"src="img/icons/teddy.png"/></td>
						
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="plant" title="plant"src="img/icons/plant.png"/></td>
						<td align="left"><img width="32" draggable="true" ondragstart="drag(event)" id="tree" title="tree"src="img/icons/tree.png"/></td>
						
						</tr>
					</table>
					<table>
						<tr valign="top">
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='0.png' alt="color" title='0.png'
								alt="" src="img/palette32/0.png" /></td>
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='1.png' alt="color" title='1.png'
								alt="" src="img/palette32/1.png" /></td>
								<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='17.png' alt="color" title='17.png'
								alt="" src="img/palette32/17.png" /></td>
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='8.png' alt="color" title='8.png'
								alt="" src="img/palette32/8.png" /></td>								
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='18.png' alt="color" title='18.png'
								alt="" src="img/palette32/18.png" /></td>	
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='19.png' alt="color" title='19.png'
								alt="" src="img/palette32/19.png" /></td>
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='4.png' alt="color" title='4.png'
								alt="" src="img/palette32/4.png" /></td>															
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='2.png' alt="color" title='2.png'
								alt="" src="img/palette32/2.png" /></td>
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='23.png' alt="color" title='23.png'
								alt="" src="img/palette32/23.png" /></td>
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='5.png' alt="color" title='5.png'
								alt="" src="img/palette32/5.png" /></td>
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='24.png' alt="color" title='24.png'
								alt="" src="img/palette32/24.png" /></td>
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='31.png' alt="color" title='31.png'
								alt="" src="img/palette32/31.png" /></td>
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='6.png' alt="color" title='6.png'
								alt="" src="img/palette32/6.png" /></td>
							<td align="left"><img border="1" width="32" draggable="true"
								ondragstart="drag(event)" id='7.png' alt="color" title='7.png'
								alt="" src="img/palette32/7.png" /></td>
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='9.png' alt="color" title='9.png'
								alt="" src="img/palette32/9.png" /></td>
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='10.png' alt="color" title='10.png'
								alt="" src="img/palette32/10.png" /></td>
						</tr>
						<tr valign="top">
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='13.png' alt="color" title='13.png'
								alt="" src="img/palette32/13.png" /></td>						
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='28.png' alt="color" title='28.png'
								alt="" src="img/palette32/28.png" /></td>		
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='14.png' alt="color" title='14.png'
								alt="" src="img/palette32/14.png" /></td>
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='15.png' alt="color" title='15.png'
								alt="" src="img/palette32/15.png" /></td>				
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='16.png' alt="color" title='16.png'
								alt="" src="img/palette32/16.png" /></td>
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='29.png' alt="color" title='29.png'
								alt="" src="img/palette32/29.png" /></td>									
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='20.png' alt="color" title='20.png'
								alt="" src="img/palette32/20.png" /></td>
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='3.png' alt="color" title='3.png'
								alt="" src="img/palette32/3.png" /></td>
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='30.png' alt="color" title='30.png'
								alt="" src="img/palette32/30.png" /></td>
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='21.png' alt="color" title='21.png'
								alt="" src="img/palette32/21.png" /></td>
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='25.png' alt="color" title='25.png'
								alt="" src="img/palette32/25.png" /></td>	
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='26.png' alt="color" title='26.png'
								alt="" src="img/palette32/26.png" /></td>							
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='22.png' alt="color" title='22.png'
								alt="" src="img/palette32/22.png" /></td>
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='11.png' alt="color" title='11.png'
								alt="" src="img/palette32/11.png" /></td>
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='27.png' alt="color" title='27.png'
								alt="" src="img/palette32/27.png" /></td>								
							<td align="left"><img width="32" draggable="true"
								ondragstart="drag(event)" id='12.png' alt="color" title='12.png'
								alt="" src="img/palette32/12.png" /></td>
						</tr>
						<tr valign="top">
						<td colspan="10">
						<div style="background-color: mintcream;">
							<span id="urlText"><b>Paste image URL</b></span>
				<a href="#" id="urlLink" onclick="changeQueryBySampleMod('url')" style="display: none;">Paste image URL</a>
				<span id="uploadText" style="display: none;"><b>Upload an image</b></span>
				<a href="#" id="uploadLink" onclick="changeQueryBySampleMod('upload')">Upload an image</a>		
				
				
				<form id="searchbar" method="POST" enctype="multipart/form-data" name="form1" action="">
				        <div class='preview'>
            <img src="" id="qbe" width="120" height="80" style="display: none;">
        </div>
				    <table cellspacing="1" cellpadding="1" border="0" style="background-color: mintcream;">                          
					     <tr>                   
					    <td valign="top">
						<input type="hidden" value="" name="" id="objId">
						<input id="urlToUpload" name="url" type="text" size="44" onclick="" onchange="if (document.getElementById('urlToUpload').value.trim() == '') document.getElementById('qbe').style.display = 'none'; document.getElementById('queryImage').value=''">
					    <input  style="display: none;" id="imageToUpload" name="imgFile" type="file" size="44" onclick="" onchange="document.getElementById('queryImage').value=''">
					    </td>                   
					    <td valign="top">
						<!-- 
						<input type="image" src="img/Search.png" value="Search" title="Search" onclick="if (trim(document.getElementById('urlToUpload').value)=='' &&  trim(document.getElementById('imageToUpload').value)=='')return false;">
					     -->
					    <input type="image" src="img/Search.png" value="Search" id='queryByExample' title="Search" onclick="document.getElementById('qbe').src=document.getElementById('urlToUpload').value; document.getElementById('qbe').style.display = 'block'; queryByExample(document.getElementById('urlToUpload').value); return false;">
					    
					    </td>
					    
					    
					</tr>
				   </table>
				   
				</form>
				</div>
				
				

						</td>
						
										<td colspan="6" valign="top">
							<input id='is43' type="checkbox" onchange="set43(this)" >4:3&nbsp;
						<input id='is169' type="checkbox" onchange="set169(this)">16:9
							<input id='isGray' type="checkbox"	onchange="setGray(this)">B/W &nbsp; 
						<input id='isColor' type="checkbox" onchange="setColor(this)">Color&nbsp;
													<br><input id='group' type="checkbox" onchange="groupResults(this)">Group by video&nbsp; 
						
						
				
						</td>
						
						
						</tr>
					</table>
				</td>
				 <td id='canvasTab'><div id="canvasdiv2"><canvas id='canvas2' width=380 height=213 style="border: 1px solid #000000;"></canvas></div></td>
				</tr>				
							
		</table>
		</div>

		<hr/>
		<div class="row">
			<div id='results' class="col" align="center"></div>
		</div>
	</div>
	<script>
	$(document).ready(function(){
	
		$(function() {
			$("#dialog").dialog({
				autoOpen: false
			});
		});	

		canvas1 = get_canvas('canvas1', 'annotations0', 'not0');
		canvas2 = get_canvas('canvas2', 'annotations1', 'not1');
		canvases = [canvas1, canvas2];
		
		
		$('#content').on('drop', dropImage);
		
		
		$("#clean").on('click', function(e) {
			console.log(isClean);
		//	if (!isClean) {
			    isClean = true;
				lastAnnotation = $("#annotations").val();
				lastNotField = $("#not").val();
				lastis43 = $("#is43").is(":checked");
				lastis169 = $("#is169").is(":checked");
				lastisColor = $("#isColor").is(":checked");
				lastisGray = $("#isGray").is(":checked");
				lastGrouped = $("#group").is(":checked");
				
				$("#annotations").val('');
				$("#not").val('');
				$('#is43').prop('checked', false);
				$('#is169').prop('checked', false);
				$('#isColor').prop('checked', false);
				$('#isGray').prop('checked', false);
				$('#group').prop('checked', false);
				
				canvasObjects = canvas1.getObjects();		
				
				canvas1.discardActiveObject().renderAll();
				canvas1.getObjects().forEach(function(o) {
					console.log("----> "+o.get('type'));
					if (o.get('type') != 'line') {
			        	$("#" + o.get('uuid')).hide();
			        	canvas1.remove(o);
					} 
			    })
			    
			    canvasObjects = canvas2.getObjects();		
				
				canvas2.discardActiveObject().renderAll();
				canvas2.getObjects().forEach(function(o) {
					console.log("----> "+o.get('type'));
					if (o.get('type') != 'line') {
			        	$("#" + o.get('uuid')).hide();
			        	canvas2.remove(o);
			        	
					} 
			    })
				txt = cell2Text(isClean);
		//	}
		});
		
		$("#undo").on('click', function(e) {
			console.log(isClean);
			if (isClean) {
	        	isClean = false;
				$("#annotations").val(lastAnnotation);
				$("#not").val(lastNotField);
				$('#is43').prop('checked', lastis43);
				$('#is169').prop('checked', lastis169);
				$('#isColor').prop('checked', lastisColor);				
				$('#isGray').prop('checked', lastisGray);
				$('#group').prop('checked', lastGrouped);
				canvasObjects.forEach(function(o) {
					if (o.get('type') != 'line') {
				        canvas1.add(o);
			        	$("#" + o.get('uuid')).show();
					}
			    })
				txt = cell2Text();
			}
		});
		
		canvas1.renderAll();
		canvas2.renderAll();
	});

	</script>

</body>
</html>